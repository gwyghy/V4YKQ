/*********************************************************************************************************************************** 文件名:  rfid_driver.c** 描　述:  RFID模块对外提供的接口** 创建人: 	沈万江** 日　期:  2014-12-26** 修改人:	** 日　期:	**** 版　本:	V1.0.0.0** 更新记录:** 更新记录	：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================****--------------------------------------------------------------------------**************************Copyright (c) 1998-1999 天津华宁电子技术有限公司技术开发部*************************************************/#include "rfid_config.h"#include "rfid_cc1101.h"#include "rfid_driver.h"extern RcvIntTransMsgFunc RcvTransMsgProc;//----------------------------------------------------------------------------------------------------// 对外提供的函数接口//----------------------------------------------------------------------------------------------------/************************************************************************************************* 函 数 名：	RFID_Init** 功能描述：	从数据存储池中取出数据** 输　  入：	void;** 输　  出：	st_RFIDRcvFrame：一包数据** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/void RFID_Init(u32 u32Sync0,u32 u32Syn1){	RFID_HarewreInit(u32Sync0,u32Syn1);		/*	 * 初始化发送消息接口函数	 */	RcvTransMsgProc = NULL;}/************************************************************************************************* 函 数 名：	RFID_ShutDown** 功能描述：	关机时的处理(以降低功耗)** 输　  入：	void;** 输　  出：	st_RFIDRcvFrame：一包数据** 作　  者：	m** 日　  期：	2015.06.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/void RFID_ShutDown(void){	SetRFChipSleep(); 	}/************************************************************************************************* 函 数 名：	RFID_RcvIntTransMsgRegister** 功能描述：	接收中断后，发送消息通知应用层程序的函数注册程序** 输　  入：	void;** 输　  出：	RcvIntTransMsgFunc函数类型声明** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 RFID_RcvIntTransMsgRegister(RcvIntTransMsgFunc AppTransMsgFunc){	RcvTransMsgProc = NULL;		if (AppTransMsgFunc != NULL)	{		RcvTransMsgProc = AppTransMsgFunc;		return 0;	}	else		return 1;}/************************************************************************************************* 函 数 名：	RFID_FetchData** 功能描述：	从数据存储池中取出数据** 输　  入：	void;** 输　  出：	st_RFIDRcvFrame：一包数据** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 RFID_FetchData(st_RFIDRcvFrame *RfidRcvFrm){	return (RFID_GetFrame(RfidRcvFrm));}/************************************************************************************************* 函 数 名：	RFID_SendData** 功能描述：	向FIFO中写入数据；** 输　  入：	u8DestAddr,数据的接收地址；**				pu8Buf，数据缓存指针；**				u32Length，数据长度指针；** 输　  出：	** 返 回 值：	** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 RFID_SendData(u8 u8DestAddr,u8 *pu8Buf, u32 *u32Length){	u8 pu8DataTmp[64],u8Length,u8Ret;	u32 u32i;		#if (CC1101_ADDR_FILTER > 0)	pu8DataTmp[1] = u8DestAddr;	for(u32i = 2; u32i < (*u32Length + 2); u32i++)	{		pu8DataTmp[u32i] = pu8Buf[u32i-2];	}	u8Length = (u8)(*u32Length) + 1;#else	for(u32i = 1; u32i < (*u32Length + 1); u32i++)	{		pu8DataTmp[u32i] = pu8Buf[u32i-1];	}	u8Length = (u8)(*u32Length);#endif	pu8DataTmp[0] = u8Length;	// 加入发送函数	u8Ret = RFTxSendPacket(pu8DataTmp, u8Length);		SetRxMode();			//进入接收模式		return((u32)u8Ret);	}/************************************************************************************************* 函 数 名：	SetRfidSIDLE** 功能描述：	设置CC1101进入空闲状态** 输　  入：	无** 输　  出：	** 返 回 值：	返回状态** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 SetRfidSIDLE(void){	return(RFCtrlSetIDLE());}/************************************************************************************************* 函 数 名：	SetRfidSRX** 功能描述：	设置CC1101进入接收状态** 输　  入：	无** 输　  出：	** 返 回 值：	返回状态** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 SetRfidSRX(void){	SetRxMode();	return 0;}/************************************************************************************************* 函 数 名：	SetRfidSTX** 功能描述：	设置CC1101进入发送状态** 输　  入：	无** 输　  出：	** 返 回 值：	返回状态** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 SetLocalAddress(u8 u8Addr){	RfidWriteReg(CC1101_ADDR,u8Addr);	DelayUs(20);	return RET_OK;}/************************************************************************************************* 函 数 名：	GetRfidCurStatus** 功能描述：	获取CC1101当前状态** 输　  入：	无** 输　  出：	** 返 回 值：	返回状态** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u8 GetRfidCurStatus(void){	return(RfidGetTxStatus());}/************************************************************************************************* 函 数 名：	GetRfidSendEnable** 功能描述：	获取CC1101是否允许发送** 输　  入：	无** 输　  出：	** 返 回 值：	RET_OK = 0:允许发送；RET_ERR = 1：不允许发送** 作　  者：	沈万江** 日　  期：	2014.12.26** 版    本：	V1.0.0** 更新记录：** 更新记录：** 					日    期      姓    名                    描      述** 					==========  =============  ========================================**************************************************************************************************/u32 GetRfidSendEnable(void){	u8 u8ChipStatus;		u8ChipStatus = RfidReadStatusReg(CC1101_PKTSTATUS);	if(u8ChipStatus & 0x10)		return RET_OK;	else		return RET_ERR;}/*********************************天津华宁电子有限公司*************************************************************/