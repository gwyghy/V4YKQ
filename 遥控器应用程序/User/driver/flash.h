/****************************************************************************日  期：2012.03.01                                                               **创建人：李微辰**修改人：**使  用：**************************************************************************/ #ifndef __STM32_SPI_FLASH_H#define __STM32_SPI_FLASH_H/* Includes ------------------------------------------------------------------*///#include "stm32_eval.h"//#include "stm32f10x.h"/*-------------------INSTRUMENT CONFIGURATION---------------------------------*/#define FLASH_SIZE_IN_BYTES    64*16*4*1024	                        //flash size,4M字节#define BLOCK_SIZE_IN_BYTES    16*4*1024							//flash block size #define SECTOR_SIZE_IN_BYTES   4*1024								//flash sector size#define PAGE_SIZE_IN_BYTES      256#define FLASH_MODEL            W25QXX 								//flash model#if	FLASH_MODEL == W25QXX#define W25QXX_SPI                       SPI3#define W25QXX_SPI_CLK                   RCC_APB1Periph_SPI3#define W25QXX_SPI_SCK_PIN               GPIO_Pin_10                  #define W25QXX_SPI_SCK_GPIO_PORT         GPIOC                       #define W25QXX_SPI_SCK_GPIO_CLK          RCC_AHBPeriph_GPIOC#define W25QXX_SPI_MISO_PIN              GPIO_Pin_11                  #define W25QXX_SPI_MISO_GPIO_PORT        GPIOC                       #define W25QXX_SPI_MISO_GPIO_CLK         RCC_AHBPeriph_GPIOC#define W25QXX_SPI_MOSI_PIN              GPIO_Pin_12                  #define W25QXX_SPI_MOSI_GPIO_PORT        GPIOC                       #define W25QXX_SPI_MOSI_GPIO_CLK         RCC_AHBPeriph_GPIOC#define W25QXX_CS_PIN                    GPIO_Pin_9                  #define W25QXX_CS_GPIO_PORT              GPIOC#define W25QXX_CS_GPIO_CLK               RCC_AHBPeriph_GPIOC#define W25QXX_WP_PIN                    GPIO_Pin_8#define W25QXX_WP_GPIO_PORT              GPIOC#define W25QXX_WP_GPIO_CLK               RCC_AHBPeriph_GPIOC#define W25QXX_CMD_WRITE          0x02  /*!< Write to Memory instruction */#define W25QXX_CMD_WRSR           0x01  /*!< Write Status Register instruction */#define W25QXX_CMD_WREN           0x06  /*!< Write enable instruction */#define W25QXX_CMD_READ           0x03  /*!< Read from Memory instruction */#define W25QXX_CMD_RDSR1          0x05  /*!< Read Status Register instruction  */#define W25QXX_CMD_RDSR2          0x35  /*!< Read Status Register instruction  */#define W25QXX_CMD_RDID           0x9F  /*!< Read identification */#define W25QXX_CMD_SE             0x20  /*!< Sector Erase instruction */#define W25QXX_CMD_BE_32K         0x52  /*!< Bulk Erase instruction */#define W25QXX_CMD_BE_64K         0xD8  /*!< Bulk Erase instruction */#define	FLASH_ID                  0x00ef4016#endif /*end of FLASH_MODEL == W25QXX*//* Private define ------------------------------------------------------------*/#if FLASH_SIZE_IN_BYTES == 64*16*4*1024#define FLASH_ADDRESS_MAX   0x003fffff#else#define FLASH_ADDRESS_MAX   0xffffffff#endif#define W25QXX_WIP_FLAG           0x01  /*!< Write In Progress (WIP) flag */#define W25QXX_DUMMY_BYTE         0xA5#define W25QXX_SPI_PAGESIZE       0x100#define W25QXX_M25P128_ID         0x202018#define W25QXX_M25P64_ID          0x202017//-------------------------------Chip Select Enable/Disable----------------------------#define W25QXX_CS_LOW()       GPIO_ResetBits(W25QXX_CS_GPIO_PORT, W25QXX_CS_PIN)#define W25QXX_CS_HIGH()      GPIO_SetBits(W25QXX_CS_GPIO_PORT, W25QXX_CS_PIN) #define W25QXX_WP_LOW()       GPIO_ResetBits(W25QXX_WP_GPIO_PORT, W25QXX_WP_PIN)#define W25QXX_WP_HIGH()      GPIO_SetBits(W25QXX_WP_GPIO_PORT, W25QXX_WP_PIN)   //-------------------------------------------------------------------------------------  /** @defgroup STM32_EVAL_SPI_FLASH_Exported_Functions  * @{  *//**  * @brief  High layer functions  */void W25QXX_DeInit(void);void W25QXX_Init(void);uint8_t W25QXX_EraseSector(uint32_t SectorAddr);uint8_t W25QXX_EraseBulk(uint32_t BulkAddr);uint8_t W25QXX_WritePage(uint8_t* pBuffer, uint32_t WriteAddr, uint16_t NumByteToWrite);uint8_t W25QXX_WriteBuffer(uint8_t* pBuffer, uint32_t WriteAddr, uint16_t NumByteToWrite);uint8_t W25QXX_ReadBuffer(uint8_t* pBuffer, uint32_t ReadAddr, uint16_t NumByteToRead);uint32_t W25QXX_ReadID(void);void W25QXX_StartReadSequence(uint32_t ReadAddr);/**  * @brief  Low layer functions  */uint8_t W25QXX_ReadByte(void);uint8_t W25QXX_SendByte(uint8_t byte);uint16_t W25QXX_SendHalfWord(uint16_t HalfWord);void W25QXX_WriteEnable(void);void W25QXX_WaitForWriteEnd(void);void W25QXX_LowLevel_DeInit(void);void W25QXX_LowLevel_Init(void);#endif /* __STM32_SPI_FLASH_H */